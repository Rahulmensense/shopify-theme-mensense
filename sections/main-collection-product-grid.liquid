{% paginate collection.products by section.settings.products_per_page %}
  <div class="product-grid">
    {% for product in paginate.items %}
      <div class="product-card">
        <div class="product-image-slider">
            <div><img src="https://cdn.shopify.com/s/files/1/0949/0975/9774/files/mensense-product-img1.png?v=1756400294" /></div>
            <div><img src="https://cdn.shopify.com/s/files/1/0949/0975/9774/files/mensense-product-img3.png?v=1756419348" /></div>
        </div>

        <h3 class="product-title">
          <a href="{{ product.url }}">{{ product.title }}</a>
        </h3>

        <div class="price">
          {% if product.compare_at_price_max > product.price %}
            <span class="current">{{ product.price | money }}</span>
            <span class="compare">{{ product.compare_at_price_max | money }}</span>
          {% else %}
            <span class="current">{{ product.price | money }}</span>
          {% endif %}
        </div>

        {% if section.settings.show_quick_add and product.available %}
          <form method="post" action="/cart/add" class="quick-add">
            <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
            <button type="submit" class="btn">Add to cart</button>
          </form>
        {% endif %}

        <button class="buy-now-btn" onclick="location.href='{{ product.url }}'">Buy Now</button>
      </div>
    {% endfor %}
  </div>

  {% if paginate.pages > 1 %}
    <nav class="pagination-links" role="navigation" aria-label="Pagination" style="margin-top:16px; display:flex; gap:8px; align-items:center;">
      {% if paginate.previous %}<a href="{{ paginate.previous.url }}" class="prev">Previous</a>{% endif %}
      {% for part in paginate.parts %}
        {% if part.is_link %}<a href="{{ part.url }}">{{ part.title }}</a>{% else %}<span class="current">{{ part.title }}</span>{% endif %}
      {% endfor %}
      {% if paginate.next %}<a href="{{ paginate.next.url }}" class="next">Next</a>{% endif %}
    </nav>
  {% endif %}
{% endpaginate %}


<script>
  function initSlickSlider(scope) {
    const sliders = (scope || document).querySelectorAll('.product-image-slider');
    sliders.forEach(function(slider) {
      if (!slider.classList.contains('slick-initialized')) {
        $(slider).slick({
          dots: true,
          arrows: true,
          infinite: true,
          speed: 300,
          slidesToShow: 1,
          adaptiveHeight: true
        });
      }
    });
  }

  function waitForSlidersAndInit() {
    const check = setInterval(() => {
      const sliders = document.querySelectorAll('.product-image-slider');
      if (sliders.length > 0) {
        initSlickSlider();
        clearInterval(check);
      }
    }, 300);
  }

  document.addEventListener("DOMContentLoaded", waitForSlidersAndInit);
  document.addEventListener("shopify:section:load", function(e) {
    initSlickSlider(e.target);
  });
</script>


