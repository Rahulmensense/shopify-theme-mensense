<section class="product-details-area">
  <div class="container">
    <div class="product-layout">
      <div class="product-grid product-detail-grid">
        <!-- LEFT: Slick Slider -->
        <div class="product-gallery-wrapper">
          <div class="product-gallery-slider js-main-slider">
            {% for image in product.images %}
              <div class="slide">
                <img src="{{ image | image_url: width: 800 }}" alt="{{ product.title }}">
              </div>
            {% endfor %}
          </div>
          <div class="product-gallery-thumbs js-thumb-slider">
            {% for image in product.images %}
              <div class="thumb">
                <img src="{{ image | image_url: width: 160 }}" alt="{{ product.title }}">
              </div>
            {% endfor %}
          </div>
        </div>

        <!-- RIGHT: Product Info -->
        <div class="product-info">
          <h1 class="product-title">{{ product.title }}</h1>
          <p class="product-brand">Brand: <strong>{{ product.vendor }}</strong></p>

          <!-- Price & Discount -->
          {% assign price = product.variants.first.price %}
          {% assign compare = product.variants.first.compare_at_price %}
          {% if compare > price %}
            {% assign discount = compare | minus: price | times: 100 | divided_by: compare | round %}
            <p class="product-price">
              <span class="sale-price">{{ price | money }}</span>
              <span class="compare-price">{{ compare | money }}</span>
              <span class="discount-badge">{{ discount }}% OFF</span>
            </p>
          {% else %}
            <p class="product-price"><span class="sale-price">{{ price | money }}</span></p>
          {% endif %}

          <!-- Rating -->
          {% assign rating = product.metafields.custom.rating_value | default: 0 %}
          {% assign reviews = product.metafields.custom.rating_count | default: 0 %}
          {% assign full_stars = rating | floor %}
          {% assign half_star = 0 %}
          {% if rating > full_stars %}
            {% assign half_star = 1 %}
          {% endif %}
          {% assign empty_stars = 5 | minus: full_stars | minus: half_star %}
          <div class="product-rating">
            <span class="stars">
              {% for i in (1..full_stars) %}<i class="fa-solid fa-star"></i>{% endfor %}
              {% if half_star == 1 %}<i class="fa-solid fa-star-half-stroke"></i>{% endif %}
              {% for i in (1..empty_stars) %}<i class="fa-regular fa-star"></i>{% endfor %}
            </span>
            <span class="rating-count">
              {% if rating > 0 %}{{ reviews }}{% if reviews == 1 %}Review{% else %}Reviews{% endif %}{% endif %}
            </span>
          </div>

          <!-- Low Stock -->
          {% assign stock = product.variants.first.inventory_quantity %}
          {% if stock < 10 %}
            <p class="low-stock">Low stock: {{ stock }} left</p>
          {% endif %}

          <!-- Size -->
          <p class="product-size">Size: {{ product.variants.first.title }}</p>
          {% comment %} ðŸ”¹ Dropdown (Multiple Sizes)
          liquid
          {% for option in product.options_with_values %}
            {% if option.name == 'Size' %}
              <label for="Size">Size:</label>
              <select id="Size" name="Size">
                {% for value in option.values %}
                  <option value="{{ value }}">{{ value }}</option>
                {% endfor %}
              </select>
            {% endif %}
          {% endfor %} {% endcomment %}

          <!-- Quantity Selector -->
          <div class="quantity-selector">
            <label>Quantity:</label>
            <div class="quantity-up-down">
              <button type="button" onclick="decreaseQty()">âˆ’</button>
              <input type="number" id="Quantity" name="quantity" min="1" value="1">
              <button type="button" onclick="increaseQty()">+</button>
            </div>
          </div>

          <!-- Add to Cart + Buy Now -->
          <form class="product-card-btn" method="post" action="/cart/add">
            <input type="hidden" name="id" value="{{ product.variants.first.id }}">
            <button type="submit" class="btn-add-to-cart">Add to Cart</button>
            <button type="submit" name="checkout" class="btn-buy-now">Buy Now</button>
          </form>

          <!-- Pincode + EDD -->
          <div class="pincode-checker">
            <label for="pincode">Enter area pincode</label>
            <input type="text" id="pincode" name="pincode" placeholder="e.g. 302001">
            <button type="button" onclick="checkEDD()">Check EDD</button>
            <p id="edd-result"></p>
          </div>

          <!-- Share Button -->
          <div class="share-buttons">
            <button onclick="navigator.share({ title: '{{ product.title }}', url: window.location.href })">Share</button>
          </div>

          <!-- Description & Metafields -->
          <div class="product-description-block">
            <p>{{ product.description }}</p>

            {% if product.metafields.custom.benefits %}
              <p><strong>Benefits:</strong> {{ product.metafields.custom.benefits }}</p>
            {% endif %}

            {% if product.metafields.custom.additional_info %}
              <p><strong>Additional Info:</strong> {{ product.metafields.custom.additional_info }}</p>
            {% endif %}

            {% if product.metafields.custom.ingredients %}
              <p><strong>Ingredients:</strong> {{ product.metafields.custom.ingredients }}</p>
            {% endif %}

            {% if product.metafields.custom.usage %}
              <p><strong>Directions for Use:</strong> {{ product.metafields.custom.usage }}</p>
            {% endif %}

            {% if product.metafields.custom.review_text %}
              <p><strong>Customer Review:</strong> {{ product.metafields.custom.review_text | truncatewords: 20 }}</p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>    
  </div>
</section>

<script>
  function increaseQty() {
    var qty = document.getElementById("Quantity");
    if (parseInt(qty.value) < 10) {
      qty.value = parseInt(qty.value) + 1;
    }
  }

  function decreaseQty() {
    var qty = document.getElementById("Quantity");
    if (parseInt(qty.value) > 1) {
      qty.value = parseInt(qty.value) - 1;
    }
  }

  function checkEDD() {
    var pin = document.getElementById("pincode").value.trim();
    var result = document.getElementById("edd-result");

    if (/^\d{6}$/.test(pin)) {
      result.innerText = "Estimated delivery: 3â€“5 days";
      result.style.color = "#28a745";
    } else {
      result.innerText = "Please enter a valid 6-digit pincode.";
      result.style.color = "#ff4d4d";
    }
  }
</script>

